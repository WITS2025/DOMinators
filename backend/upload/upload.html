<!DOCTYPE html>
<html>
<head>
  <title>Upload Trip Image</title>
</head>
<body>
  <h1>Upload a Trip Image</h1>
  
  <form id="upload-form">
    <label for="file">Choose an image:</label><br />
    <input type="file" id="file" accept="image/*" required /><br /><br />
    <button type="submit">Upload</button>
  </form>

  <p id="status"></p>
  <img id="preview" src="" style="max-width: 400px; display: none; margin-top: 20px;" />

  <script>
    document.getElementById('upload-form').addEventListener('submit', async function (e) {
      e.preventDefault();

      const fileInput = document.getElementById('file');
      const file = fileInput.files[0];

      if (!file) {
        alert("Please select a file.");
        return;
      }

      const fileType = file.type;

      // Step 1: Request presigned URL from backend
      const res = await fetch("https://<your-api-id>.execute-api.<region>.amazonaws.com/uploadTripImage", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ fileType })
      });

      if (!res.ok) {
        document.getElementById("status").innerText = "Failed to get upload URL.";
        return;
      }

      const { uploadUrl, imageUrl } = await res.json();

      // Step 2: Upload image directly to S3
      const uploadRes = await fetch(uploadUrl, {
        method: "PUT",
        headers: { "Content-Type": fileType },
        body: file
      });

      if (!uploadRes.ok) {
        document.getElementById("status").innerText = "Image upload failed.";
        return;
      }

      // Show uploaded image
      document.getElementById("status").innerText = "Upload successful!";
      const preview = document.getElementById("preview");
      preview.src = imageUrl;
      preview.style.display = "block";
    });
  </script>
</body>
</html>
